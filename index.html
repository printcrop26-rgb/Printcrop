<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Printcrop â€” A4 Label Tool</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>

<style>
body{
  margin:0; padding:20px; background:#0f172a; color:#fff;
  font-family:system-ui,-apple-system,Arial,sans-serif;
}
.card{
  border:2px solid #38bdf8; border-radius:12px;
  padding:16px; margin-bottom:16px;
}
h2{margin:0 0 10px}
label{display:block; margin-bottom:8px}
.primary-btn{
  width:100%; padding:14px; font-size:16px;
  background:#38bdf8; color:#000; border:none;
  border-radius:10px; cursor:pointer;
}
.primary-btn:disabled{opacity:.6; cursor:not-allowed}
small{opacity:.7}
</style>
</head>

<body>

<div class="card">
  <h2>Select Company</h2>
  <label><input type="radio" name="company" value="meesho" checked> Meesho</label>
  <label><input type="radio" name="company" value="amazon"> Amazon</label>
  <label><input type="radio" name="company" value="flipkart"> Flipkart</label>
</div>

<div class="card">
  <h2>Select Mode</h2>
  <label><input type="radio" name="mode" value="a4" checked> A4 (Auto fit)</label>
  <label><input type="radio" name="mode" value="thermal"> Thermal (ignored for now)</label>
  <small>Note: A4 auto-fit is enabled. No manual settings.</small>
</div>

<div class="card">
  <h2>Upload Label PDF</h2>
  <input type="file" id="pdfFile" accept="application/pdf">
</div>

<div class="card">
  <button id="genBtn" class="primary-btn" type="button">
    Generate & Download A4 PDF
  </button>
</div>

<script>
(function(){
  const btn = document.getElementById('genBtn');
  const fileInput = document.getElementById('pdfFile');

  // Silent-safe click handler
  btn.addEventListener('click', async () => {
    try{
      if(!fileInput.files || !fileInput.files.length) return;

      btn.disabled = true;

      const bytes = await fileInput.files[0].arrayBuffer();
      const src = await PDFLib.PDFDocument.load(bytes);
      const out = await PDFLib.PDFDocument.create();

      // A4 size (points)
      const A4_W = 595, A4_H = 842;
      const CELL_W = A4_W / 2, CELL_H = A4_H / 2;

      const pages = src.getPages();

      // Auto-fit: 4 labels per A4 page
      for(let i=0;i<pages.length;i++){
        const a4 = out.addPage([A4_W, A4_H]);
        const emb = await out.embedPage(pages[i]);

        a4.drawPage(emb,{x:0,y:CELL_H,width:CELL_W,height:CELL_H});
        a4.drawPage(emb,{x:CELL_W,y:CELL_H,width:CELL_W,height:CELL_H});
        a4.drawPage(emb,{x:0,y:0,width:CELL_W,height:CELL_H});
        a4.drawPage(emb,{x:CELL_W,y:0,width:CELL_W,height:CELL_H});
      }

      const finalBytes = await out.save();
      const blob = new Blob([finalBytes], {type:'application/pdf'});
      const url = URL.createObjectURL(blob);

      const a = document.createElement('a');
      a.href = url;
      a.download = 'Printcrop_A4_Labels.pdf';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);

    }catch(e){
      // Silent fail: do nothing (professional behaviour)
      // User can reselect file and try again
    }finally{
      btn.disabled = false;
    }
  });
})();
</script>

</body>
</html>
