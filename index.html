<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>printcrop â€“ Free Label Tool</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Inter,Arial,sans-serif}
body{background:linear-gradient(180deg,#0b1e2d,#0f2f46);color:#fff}

.container{max-width:420px;margin:auto;padding:16px}
header{background:#fff;color:#000;padding:14px;text-align:center;border-radius:0 0 20px 20px}
h1{color:#1e3a8a;font-size:24px}

.card{background:#fff;color:#000;border-radius:18px;padding:18px;margin-top:20px}

.company{
  border:2px solid #e5e7eb;
  border-radius:14px;
  padding:14px;
  text-align:center;
  margin-bottom:10px;
  font-weight:600;
  cursor:pointer;
}
.company.active{border-color:#2da4ff;background:#f0f9ff;color:#2da4ff}

.options{display:flex;gap:10px;margin:16px 0}
.options input{display:none}
.options label{
  flex:1;border:2px solid #e5e7eb;
  padding:12px;text-align:center;
  border-radius:999px;cursor:pointer;font-weight:600
}
.options input:checked+label{
  border-color:#2da4ff;background:#f0f9ff;color:#2da4ff
}

.upload{
  border:2px dashed #94a3b8;
  padding:20px;text-align:center;
  border-radius:14px;margin-bottom:16px
}

button{
  width:100%;
  background:linear-gradient(135deg,#2563eb,#38bdf8);
  color:#fff;
  padding:18px;
  font-size:18px;
  border:none;
  border-radius:14px;
  font-weight:700;
  cursor:pointer
}
button:active{transform:scale(.97)}
</style>
</head>

<body>

<header>
  <h1>printcrop <span style="font-size:12px;background:#dcfce7;color:#166534;padding:4px 8px;border-radius:20px">100% Free</span></h1>
</header>

<div class="container">
  <div class="card">
    <h3>Select Company</h3>
    <div class="company" data-company="Amazon">Amazon</div>
    <div class="company" data-company="Flipkart">Flipkart</div>
    <div class="company" data-company="Meesho">Meesho</div>

    <h3 style="margin-top:20px">Select Print Type</h3>
    <div class="options">
      <input type="radio" id="a4" name="print" checked>
      <label for="a4">A4 Sheet</label>

      <input type="radio" id="label" name="print">
      <label for="label">Label Printer</label>
    </div>

    <div class="upload">
      <b>Upload Label PDF</b><br><br>
      <input type="file" id="pdfFile" accept="application/pdf">
    </div>

    <button id="downloadBtn">Download Final PDF</button>
  </div>
</div>

<script>
const { PDFDocument } = PDFLib;
let selectedCompany = null;

document.querySelectorAll('.company').forEach(c=>{
  c.onclick = ()=>{
    document.querySelectorAll('.company').forEach(x=>x.classList.remove('active'));
    c.classList.add('active');
    selectedCompany = c.dataset.company;
  }
});

document.getElementById('downloadBtn').onclick = async ()=>{
  if(!selectedCompany){ alert("Select company"); return; }
  const file = document.getElementById('pdfFile').files[0];
  if(!file){ alert("Upload PDF"); return; }

  const bytes = await file.arrayBuffer();
  const srcPdf = await PDFDocument.load(bytes);
  const outPdf = await PDFDocument.create();

  const pages = srcPdf.getPages();
  const A4_W = 595, A4_H = 842;
  const slotW = A4_W / 2;
  const slotH = A4_H / 2;

  const positions = [
    {x:0,y:A4_H/2},
    {x:slotW,y:A4_H/2},
    {x:0,y:0},
    {x:slotW,y:0}
  ];

  let slot = 0;
  let page;

  for(let i=0;i<pages.length;i++){
    if(slot===0) page = outPdf.addPage([A4_W,A4_H]);

    const embed = await outPdf.embedPage(pages[i]);

    // ðŸ”¥ HEIGHT BASED SCALING (FINAL FIX)
    const scale = slotH / embed.height;

    const drawX = positions[slot].x + (slotW - embed.width * scale)/2;
    const drawY = positions[slot].y + (slotH - embed.height * scale)/2;

    page.drawPage(embed,{
      x: drawX,
      y: drawY,
      xScale: scale,
      yScale: scale
    });

    slot++;
    if(slot===4) slot = 0;
  }

  const finalBytes = await outPdf.save();
  const blob = new Blob([finalBytes],{type:"application/pdf"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = `printcrop_${selectedCompany}.pdf`;
  a.click();
};
</script>

</body>
</html>
