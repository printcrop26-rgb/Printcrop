<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>printcrop â€“ Free Label Tool</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Inter,sans-serif}
body{background:linear-gradient(180deg,#0b1e2d,#0f2f46);color:#fff;min-height:100vh}
.container{max-width:480px;margin:auto;padding:20px}
header{background:#fff;color:#000;padding:14px;text-align:center;border-radius:0 0 20px 20px}
h1{color:#1e3a8a;font-size:24px}
.card{background:#fff;color:#000;border-radius:18px;padding:20px;margin-top:20px;box-shadow:0 10px 25px rgba(0,0,0,.3)}
.company{border:2px solid #e5e7eb;border-radius:14px;padding:14px;text-align:center;margin-bottom:10px;cursor:pointer;font-weight:600}
.company.active{border-color:#2da4ff;background:#f0f9ff;color:#2da4ff}
.options{display:flex;gap:10px;margin:16px 0}
.options label{flex:1;border:2px solid #e5e7eb;padding:12px;text-align:center;border-radius:999px;cursor:pointer;font-weight:600}
input[type="radio"]{display:none}
input[type="radio"]:checked+label{border-color:#2da4ff;background:#f0f9ff;color:#2da4ff}
.upload{border:2px dashed #94a3b8;padding:25px;text-align:center;border-radius:14px;margin-bottom:16px;background:#f8fafc}
#pdf{margin-top:10px;width:100%}
button{width:100%;background:linear-gradient(135deg,#2563eb,#38bdf8);color:#fff;padding:18px;font-size:18px;font-weight:700;border:none;border-radius:14px;cursor:pointer}
button:active{transform:scale(.97)}
</style>
</head>

<body>

<header>
<h1>printcrop <span style="font-size:12px;background:#dcfce7;color:#166534;padding:4px 8px;border-radius:20px;margin-left:8px">100% Free</span></h1>
</header>

<div class="container">
<div class="card">

<h3>Select Company</h3>
<div class="company" data-c="Amazon">Amazon</div>
<div class="company" data-c="Flipkart">Flipkart</div>
<div class="company" data-c="Meesho">Meesho</div>

<h3 style="margin-top:25px">Select Print Type</h3>
<div class="options">
<input type="radio" id="a4" name="p" checked>
<label for="a4">A4 Sheet</label>
<input type="radio" id="lp" name="p">
<label for="lp">Label Printer</label>
</div>

<div class="upload">
<b style="font-size:18px">Upload Label PDF</b><br>
<input type="file" id="pdf" accept="application/pdf">
</div>

<button id="download">Download Final PDF</button>

</div>
</div>

<script>
const { PDFDocument } = PDFLib;
let selectedCompany = null;

document.querySelectorAll('.company').forEach(c=>{
  c.onclick=()=>{
    document.querySelectorAll('.company').forEach(x=>x.classList.remove('active'));
    c.classList.add('active');
    selectedCompany=c.dataset.c;
  };
});

document.getElementById('download').onclick = async () => {

  if(!selectedCompany){ alert("Select company"); return; }
  const file=document.getElementById('pdf').files[0];
  if(!file){ alert("Upload PDF"); return; }

  const btn=document.getElementById('download');
  btn.innerText="Processing...";
  btn.disabled=true;

  const srcBytes = await file.arrayBuffer();
  const srcPdf = await PDFDocument.load(srcBytes);
  const outPdf = await PDFDocument.create();

  /* ðŸ”¥ STEP 1: Detect & Split labels like Quick Label Crop */
  const rawPages = srcPdf.getPages();
  let labels = [];

  rawPages.forEach(p=>{
    const w = p.getWidth();
    const h = p.getHeight();

    if(w > h * 1.3){
      labels.push({page:p, type:"left"});
      labels.push({page:p, type:"right"});
    }else{
      labels.push({page:p, type:"full"});
    }
  });

  /* ðŸ”¥ STEP 2: A4 4-slot layout */
  const A4_W = 595, A4_H = 842;
  const slots = [
    {x:0,        y:A4_H/2},
    {x:A4_W/2,   y:A4_H/2},
    {x:0,        y:0},
    {x:A4_W/2,   y:0},
  ];

  let buffer=[];

  for(let i=0;i<labels.length;i++){
    buffer.push(labels[i]);

    if(buffer.length===4 || i===labels.length-1){
      const page = outPdf.addPage([A4_W,A4_H]);

      for(let j=0;j<buffer.length;j++){
        let embed;

        if(buffer[j].type==="left"){
          embed = await outPdf.embedPage(
            buffer[j].page,
            {left:0,bottom:0,right:buffer[j].page.getWidth()/2,top:buffer[j].page.getHeight()}
          );
        }
        else if(buffer[j].type==="right"){
          embed = await outPdf.embedPage(
            buffer[j].page,
            {left:buffer[j].page.getWidth()/2,bottom:0,right:buffer[j].page.getWidth(),top:buffer[j].page.getHeight()}
          );
        }
        else{
          embed = await outPdf.embedPage(buffer[j].page);
        }

        const slotW=A4_W/2, slotH=A4_H/2;
        const scale=Math.min(slotW/embed.width,slotH/embed.height);
        const x=slots[j].x+(slotW-embed.width*scale)/2;
        const y=slots[j].y+(slotH-embed.height*scale)/2;

        page.drawPage(embed,{x,y,scale});
      }
      buffer=[];
    }
  }

  const bytes = await outPdf.save();
  const blob = new Blob([bytes],{type:"application/pdf"});
  const url = URL.createObjectURL(blob);

  const a=document.createElement("a");
  a.href=url;
  a.download=`printcrop_${selectedCompany}_A4.pdf`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);

  btn.innerText="Download Final PDF";
  btn.disabled=false;
};
</script>

</body>
</html>
